---
title: 04 | 深入浅出索引（上）
date: 2019-01-08 14:22:43
tags: [MySQL]
categories :
- 学习笔记
- MySQL
- MySQL实战45讲
---


索引的常见模型
哈希表。适合插入数据与做等值查询，不适合做区间查询。
有序数组。适合做等值查询与区间查询（使用二分法），不适合插入数据。所以这种适合做静态存储引擎。
搜索树。二叉搜索树->平衡二叉树->N叉树（B+树）
二叉搜索树：左孩子节点<父节点<右孩子节点
平衡二叉树：左右两棵子树的高度差绝对值不超过1，并且左右两棵子树都是平衡二叉树。（维持 O(log(N)) 的查询复杂度）
N叉树：（为了查询尽量少地读磁盘）。


InnoDB的索引模型
![](MySQL实战45讲（四）\Innodb索引.png)

索引类型分为主键索引与非主键索引。
主键索引的叶子节点存的是整行数据。在Innodb中，主键索引也称为聚簇索引。
而非主键索引叶子节点存的是主键的值。非主键索引也称为二级索引。

主键索引与非主键索引查询的区别
主键索引只用扫描一棵树就可以查询到行的数据。
而非主键索引比主键索引要多扫描一棵树。（回表）

没有主键的表，innodb会给默认创建一个Rowid做主键

索引的维护
B+树的插入可能会引起数据页的分裂，删除可能会引起数据页的合并，二者都是比较重的IO消耗，所以比较好的方式是顺序插入数据，这也是我们一般使用自增主键的原因之一。

主键长度越小，普通索引的叶子节点就越小，普通索引占用的空间也就越小。所以不适合用业务字段（如身份证）做主键。
但是如果一张表只有一个唯一索引，那么可以用业务字段作主键。
（那主键的B+树的叶子节点是怎么存主键id的，应该也会耗空间的啊）

MyISAM的索引结构是“堆组织表”，非主键索引上叶子节点存的是行的地址而不是主键。这样使用非主键索引进行查询时，就不需要回表。但是如果行数据的位置被修改了，就会很麻烦。








<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.5.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.5.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.5.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.5.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="aFightz">
<meta property="og:url" content="http://yoursite.com/page/7/index.html">
<meta property="og:site_name" content="aFightz">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="aFightz">






  <link rel="canonical" href="http://yoursite.com/page/7/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>aFightz</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">aFightz</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/03/Docker核心技术_04_Docker命令/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aFightz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aFightz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/03/Docker核心技术_04_Docker命令/" class="post-title-link" itemprop="http://yoursite.com/page/7/index.html">04 | Docker命令</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-03 17:40:42" itemprop="dateCreated datePublished" datetime="2019-07-03T17:40:42+08:00">2019-07-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-01-07 16:21:41" itemprop="dateModified" datetime="2020-01-07T16:21:41+08:00">2020-01-07</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Docker/Docker核心技术/" itemprop="url" rel="index"><span itemprop="name">Docker核心技术</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="✎帮助命令"><a href="#✎帮助命令" class="headerlink" title="✎帮助命令"></a><center><font color="#36648B">✎</font><br><font color="#36648B">帮助命令</font></center></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br><span class="line">docker info</span><br><span class="line">docker --help</span><br></pre></td></tr></table></figure>
<h4 id="✎✎镜像命令"><a href="#✎✎镜像命令" class="headerlink" title="✎✎镜像命令"></a><center><font color="#36648B">✎✎</font><br><font color="#36648B">镜像命令</font></center></h4><p><strong>1、列出本机的镜像</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images [OPTIONS]</span><br></pre></td></tr></table></figure></p>
<p><font color="#CD5555">表头信息：</font></p>
<ul>
<li><strong>REPOSITORY</strong>：镜像的仓库源。              </li>
<li><strong>TAG</strong>：镜像的标签（同一仓库源可以有多个TAG）。 </li>
<li><strong>IMAGE ID</strong>：镜像ID。                 </li>
<li><strong>CREATED</strong>：镜像创建时间。              </li>
<li><strong>SIZE</strong>：镜像大小。  </li>
</ul>
<p><font color="#CD5555">OPTIONS：</font></p>
<ul>
<li><strong>-a</strong>：列出本地所有的镜像（含中间映像层 ）。</li>
<li><strong>-q</strong>：只显示镜像ID。            </li>
<li><strong>–digests</strong>：显示镜像的摘要信息。         </li>
<li><strong>–no-trunc</strong>：显示完整的镜像信息。         </li>
</ul>
<p><font color="#CD5555">镜像就相当于一个千层饼</font>。</p>
<p><strong>2、Docker镜像查找</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search [IMAGE_NAME] #可模糊查找，即使配了阿里云镜像加速，也会到DockerHub查。</span><br></pre></td></tr></table></figure></p>
<p><font color="#CD5555">OPTIONS：</font></p>
<ul>
<li><strong>–no-trunc</strong>：显示完整的镜像描述。</li>
<li><strong>-s</strong>：列出收藏数不小于指定值的镜像。</li>
<li><strong>–automated</strong>：只列出automated build类型的镜像。</li>
</ul>
<p><strong>3、拉Docker镜像</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull [IMAGE_NAME]</span><br></pre></td></tr></table></figure></p>
<p><strong>4、删除镜像</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f [IMAGE_ID]                            #删除单个</span><br><span class="line">docker rmi -f [IMAGE_NAME] [IMAGE_NAME]    #删除多个</span><br><span class="line">docker rmi -f $(docker images -qa)             #删除全部</span><br></pre></td></tr></table></figure></p>
<p><strong>5、查看镜像构建历史</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker history [IMAGE]</span><br></pre></td></tr></table></figure></p>
<p><strong>6、给镜像命名</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag [IMAGE_ID] [REPOSITORY]:[TAG]</span><br></pre></td></tr></table></figure></p>
<h4 id="✎✎✎容器命令"><a href="#✎✎✎容器命令" class="headerlink" title="✎✎✎容器命令"></a><center><font color="#36648B">✎✎✎</font><br><font color="#36648B">容器命令</font></center></h4><p><strong>1、新建并启动容器</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run [OPTIONS] [IMAGE] [COMMAND][ARG..]</span><br></pre></td></tr></table></figure></p>
<p><font color="#CD5555">OPTIONS：</font></p>
<ul>
<li><strong>–name</strong>：为容器指定一个名称。</li>
<li><strong>-d</strong>：后台运行容器，并返回容器ID，也即启动守护式容器。</li>
<li><strong>-i</strong>：以交互模式运行容器，通常与-t同时使用。</li>
<li><strong>-t</strong>：为容器重新分配一个伪输入终端，通常与-i同时使用。</li>
<li><strong>-e</strong>：设置环境的变量。</li>
<li><strong>-P</strong>：随机端口映射。</li>
<li><strong>-p</strong>：指定端口映射，有以下四种格式：<ul>
<li>ip:hostPort:containerPort </li>
<li>ip:containerPort </li>
<li>hostPort:containerPort </li>
<li>containerPort</li>
</ul>
</li>
</ul>
<p><font color="#CD5555"><strong>启动并进入交互式容器</strong></font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it [IMAGE] = docker run -it [IMAGE] /bin/bash</span><br></pre></td></tr></table></figure></p>
<p><font color="#CD5555"><strong>启动守护式容器</strong></font>(以后台进程方式运行)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d [IMAGE]</span><br></pre></td></tr></table></figure></p>
<p>Docker容器运行，需要有一个前台进程。容器运行的命令如果不是那些一直挂起的命令（比如运行top，tail)，是会自动退出的。<br>可以启动容器并循环打印消息到前台（如下），这样容器就不会自动退出。（自动退出检测的时间间隔是多久？）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run-d [IMAGE] /bin/sh -c &quot;while true;do echo hello zzyy;sleep 2;done&quot;（可以通过容器日志看到这些输出。）</span><br></pre></td></tr></table></figure></p>
<p><font color="#CD5555"><strong>启动时指定端口映射</strong></font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p 8080(容器端口):8080(宿主机端口) [IMAGE]</span><br><span class="line"></span><br><span class="line">#宿主机端口随机分配</span><br><span class="line">docker run -it -P [IMAGE]</span><br></pre></td></tr></table></figure></p>
<p><strong>2、列出当前所有正在运行的容器</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps [OPTIONS]</span><br></pre></td></tr></table></figure></p>
<p><font color="#CD5555">OPTIONS：</font></p>
<ul>
<li><strong>-a</strong>：列出当前所有正在运行的容器+历史上运行过的</li>
<li><strong>-l</strong> ：显示最近创建的容器。</li>
<li><strong>-n</strong>：显示最近n个创建的一个容器。</li>
<li><strong>-q</strong>：静默模式，只显示容器编号。</li>
<li><strong>–no-trunc</strong>：不截断输出。</li>
</ul>
<p><strong>3、退出容器</strong></p>
<ul>
<li><strong>exit</strong>: 容器停止退出。</li>
<li><strong>ctrl+P+Q</strong>: 容器不停止退出。</li>
</ul>
<p><strong>4、启动容器</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start [CONTAINER]</span><br></pre></td></tr></table></figure></p>
<p><strong>5、重启容器</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart [CONTAINER]</span><br></pre></td></tr></table></figure></p>
<p><strong>6、停止容器</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop [CONTAINER]</span><br></pre></td></tr></table></figure></p>
<p><strong>7、强制停止容器</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker kill [CONTAINER]</span><br></pre></td></tr></table></figure></p>
<p><strong>8、删除已停止的容器</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker rm [CONTAINER_ID]</span><br><span class="line">docker rm -f [CONTAINER_ID](强制删除，可以删除正在运行的容器)</span><br></pre></td></tr></table></figure></p>
<p><strong>9、一次性删除多个容器</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker rm -f $(docker ps -a -q)</span><br><span class="line">docker ps -a -q | xargs docker rm</span><br></pre></td></tr></table></figure></p>
<p><strong>10、查看容器日志</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f -t --tail [CONTAINER_ID]</span><br></pre></td></tr></table></figure></p>
<ul>
<li>-t: 是加入时间戳。</li>
<li>-f: 跟随最新的日志打印。</li>
<li>–tail: 数字显示最后多少条。</li>
</ul>
<p><strong>11、查看容器内运行的进程</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker top [CONTAINER_ID]</span><br></pre></td></tr></table></figure></p>
<p><strong>12、查看容器内部细节</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect [CONTAINER_ID]</span><br></pre></td></tr></table></figure></p>
<p><strong>13、进入正在运行的容器并以命令行交互</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it [CONTAINER_ID] [BASH_SHELL]</span><br></pre></td></tr></table></figure></p>
<p>exec是在容器中打开新的终端，并且可以启动新的进程。（不用进入到容器内进行交互，可以直接执行bashShell）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker attach [CONTAINER_ID] = docker exec-t [CONTAINER_ID] /bin/bash</span><br></pre></td></tr></table></figure></p>
<p>attach直接进入容器启动命令的终端，不会启动新的进程<br>attach进入容器后，exit会退出并关闭容器，exec进入容器（用/bin/bash这种方式），exit会退出但并不关闭容器。</p>
<p><strong>13、从容器内拷贝文件到主机上</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp [CONTAINER_ID]:[容器内路径] [目的主机路径]</span><br></pre></td></tr></table></figure></p>
<h4 id="✎✎✎导入与导出"><a href="#✎✎✎导入与导出" class="headerlink" title="✎✎✎导入与导出"></a><center><font color="#36648B">✎✎✎</font><br><font color="#36648B">导入与导出</font></center></h4><p><strong>1、导出镜像 &gt; 导入镜像</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#导出</span><br><span class="line">docker save -o [目标文件] [IMAGE]</span><br><span class="line">docker save &gt; [目标文件] [IMAGE]</span><br><span class="line">#导出</span><br><span class="line">docker load &lt; [目标文件]</span><br><span class="line">docker load -i [目标文件]</span><br></pre></td></tr></table></figure></p>
<p><strong>2、导出容器 &gt; 导入镜像</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#导出</span><br><span class="line">docker export -o [目标文件] [CONTAINER]</span><br><span class="line">#导入</span><br><span class="line">docker import [目标文件] [REPOSITORY]:[TAG]</span><br><span class="line">cat [目标文件] | docker import - [REPOSITORY]:[TAG]</span><br></pre></td></tr></table></figure></p>
<p><strong>3、这两者的区别</strong></p>
<ul>
<li>save的来源是镜像，export的来源是容器。</li>
<li>export的文件会小一点。</li>
<li>load会保存镜像的所有历史记录。import丢失所有元数据和历史记录，仅保存容器当时的状态。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/03/Docker核心技术_03_Docker的helloworld/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aFightz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aFightz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/03/Docker核心技术_03_Docker的helloworld/" class="post-title-link" itemprop="http://yoursite.com/page/7/index.html">03 | Docker的helloworld</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-03 17:19:48" itemprop="dateCreated datePublished" datetime="2019-07-03T17:19:48+08:00">2019-07-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-01-07 16:21:41" itemprop="dateModified" datetime="2020-01-07T16:21:41+08:00">2020-01-07</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Docker/Docker核心技术/" itemprop="url" rel="index"><span itemprop="name">Docker核心技术</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="✎镜像加速"><a href="#✎镜像加速" class="headerlink" title="✎镜像加速"></a><center><font color="#36648B">✎</font><br><font color="#36648B">镜像加速</font></center></h4><p>将配置文件的仓库地址修改为阿里云的镜像加速地址。（具体步骤可以去阿里云仓库看）<br>可用<code>ps -ef</code>命令查看docker的启动配置是否是修改的阿里云镜像加速地址。</p>
<h4 id="✎✎run-hello-world镜像"><a href="#✎✎run-hello-world镜像" class="headerlink" title="✎✎run hello world镜像"></a><center><font color="#36648B">✎✎</font><br><font color="#36648B">run hello world镜像</font></center></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world（不添加版本号，则默认是 hello-world:latest）</span><br></pre></td></tr></table></figure>
<p><strong>run的过程</strong><br><img src="/2019/07/03/Docker核心技术_03_Docker的helloworld/run命令的过程.jpg" alt=""></p>
<h4 id="✎✎✎运行原理"><a href="#✎✎✎运行原理" class="headerlink" title="✎✎✎运行原理"></a><center><font color="#36648B">✎✎✎</font><br><font color="#36648B">运行原理</font></center></h4><p>Docker是一个<font color="#CD5555">Client-Server</font>结构的系统，<font color="#CD5555">Docker守护进程</font>运行在主机上，然后通过<font color="#CD5555">Socket连接</font>从客户端访问，守护进程从客户端接受命令并管理运行在主机上的容器。</p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/02/Docker核心技术_02_Docker的安装/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aFightz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aFightz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/02/Docker核心技术_02_Docker的安装/" class="post-title-link" itemprop="http://yoursite.com/page/7/index.html">02 | Docker的安装</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-02 20:03:01" itemprop="dateCreated datePublished" datetime="2019-07-02T20:03:01+08:00">2019-07-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-01-07 16:21:41" itemprop="dateModified" datetime="2020-01-07T16:21:41+08:00">2020-01-07</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Docker/Docker核心技术/" itemprop="url" rel="index"><span itemprop="name">Docker核心技术</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="✎✎系统要求"><a href="#✎✎系统要求" class="headerlink" title="✎✎系统要求"></a><center><font color="#36648B">✎✎</font><br><font color="#36648B">系统要求</font></center></h4><p>Docker运行在<font color="#CD5555">CentOs-6.5</font>或更高版本的CentOs上，要求系统为64位、系统内核版本为<font color="#CD5555">2.6.32-431</font>或者更高版本。</p>
<p><strong>查看自己的内核</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -r</span><br></pre></td></tr></table></figure></p>
<p><strong>查看centos版本</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/reahat-release</span><br></pre></td></tr></table></figure></p>
<h4 id="✎✎Centos6-8安装Docker"><a href="#✎✎Centos6-8安装Docker" class="headerlink" title="✎✎Centos6.8安装Docker"></a><center><font color="#36648B">✎✎</font><br><font color="#36648B">Centos6.8安装Docker</font></center></h4><p><strong>1、Docker使用EPEL发布，RHEL系的OS首先要确保已经持有EPEL仓库，否则先检查OS的版本，然后装相应的EPEL包。</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install-y epel-release</span><br></pre></td></tr></table></figure></p>
<p><strong>2、安装Docker</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install-y docker-io</span><br></pre></td></tr></table></figure></p>
<p><strong>3、安装后的配置文件路径</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/sysconfig/docker</span><br></pre></td></tr></table></figure></p>
<p><strong>4、启动Docker后台服务</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service docker start</span><br></pre></td></tr></table></figure></p>
<p><strong>5、验证Docker版本</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure></p>
<h4 id="✎✎✎开启2375端口"><a href="#✎✎✎开启2375端口" class="headerlink" title="✎✎✎开启2375端口"></a><center><font color="#36648B">✎✎✎</font><br><font color="#36648B">开启2375端口</font></center></h4><p><strong>1、编辑以下文本</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/docker.service</span><br><span class="line">#或者</span><br><span class="line">vim /lib/systemd/system/docker.service</span><br></pre></td></tr></table></figure></p>
<p>将文件内容编辑如下(简略)：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix://var/run/docker.sock \</span><br></pre></td></tr></table></figure></p>
<p><strong>2、重启docker</strong></p>
<pre><code>systemctl daemon-reload   
systemctl restart docker
</code></pre>
          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/02/Docker核心技术_01_Docker基础概念/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aFightz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aFightz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/02/Docker核心技术_01_Docker基础概念/" class="post-title-link" itemprop="http://yoursite.com/page/7/index.html">01 | Docker基础概念</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-02 19:33:08" itemprop="dateCreated datePublished" datetime="2019-07-02T19:33:08+08:00">2019-07-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-01-07 16:21:41" itemprop="dateModified" datetime="2020-01-07T16:21:41+08:00">2020-01-07</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Docker/Docker核心技术/" itemprop="url" rel="index"><span itemprop="name">Docker核心技术</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="✎Docker与传统虚拟机"><a href="#✎Docker与传统虚拟机" class="headerlink" title="✎Docker与传统虚拟机"></a><center><font color="#36648B">✎</font><br><font color="#36648B">Docker与传统虚拟机</font></center></h4><p><strong>1、Docker</strong><br>Docker是用Go语言写的。<br>Docker Client只与Docker daemon交互。<br>Docker三要素：<font color="#CD5555">仓库、镜像、容器</font>。</p>
<ul>
<li>Docker镜像：<ul>
<li>Docker镜像就是一个只读的模板。</li>
<li>镜像可以用来创建Docker容器，一个镜像可以创建多个容器。</li>
<li><font color="#CD5555">镜像就相当于一个类</font>。</li>
</ul>
</li>
<li>容器<ul>
<li>容器的定义和镜像几乎一模一样，也是有一堆层，唯一的区别在于容器的最上面那一层是可读可写的。</li>
<li><font color="#CD5555">容器相当于一个对象</font>。</li>
<li>容器不是模拟一个完整的操作系统，而是对进程进行隔离。（只需要内核）</li>
</ul>
</li>
<li>仓库<ul>
<li>仓库是集中存放镜像文件的场所。</li>
<li>仓库和仓库注册服务器是有区别的。仓库注册服务器上往往存放着多个仓库，每个仓库又包含了多个镜像，每个镜像有不同的标签。</li>
<li>仓库分为公开仓库和私有仓库两种形式。</li>
<li>最大的公开仓库是Docker Hub。国内的公开仓库包括阿里云、网易云等。</li>
</ul>
</li>
</ul>
<p><strong>2、传统虚拟机</strong><br>传统虚拟机缺点：资源占用多、冗余步骤多、启动慢。（模拟一个完整的操作系统，包括硬件等 ）</p>
<p><strong>3、区别</strong></p>
<ul>
<li>传统虚拟机技术是虚拟出一套硬件后，在其上运行一个完整的操作系统，在该系统上再运行所需应用进程。</li>
<li>而容器内应用直接运行于宿主内核，容器内没有自己的内核，而且也没有进行硬件虚拟，因此容器要比传统虚拟机更加轻便。</li>
<li>每个容器之间互相隔离，每个容器有自己的文件系统，容器之间进程不会互相影响，能区分计算资源。<blockquote>
<p><strong>问题</strong>：那么宿主的版本会影响容器吗？会。</p>
</blockquote>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/14/Java核心技术卷1_03_Java的基本程序设计结构/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aFightz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aFightz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/14/Java核心技术卷1_03_Java的基本程序设计结构/" class="post-title-link" itemprop="http://yoursite.com/page/7/index.html">03 | Java的基本程序设计结构</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-14 16:26:40" itemprop="dateCreated datePublished" datetime="2019-06-14T16:26:40+08:00">2019-06-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-01-07 16:21:41" itemprop="dateModified" datetime="2020-01-07T16:21:41+08:00">2020-01-07</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Java/Java核心技术卷1/" itemprop="url" rel="index"><span itemprop="name">Java核心技术卷1</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="✎规范"><a href="#✎规范" class="headerlink" title="✎规范"></a><center><font color="#36648B">✎</font><br><font color="#36648B">规范</font></center></h4><p><strong>1、类名的规范</strong><br>名字必须以<font color="#CD5555">字母开头</font>，后面可以跟<font color="#CD5555">字母和数字的任意组合</font>，长度基本上没有限制。(不能用java保留字)。</p>
<p><strong>2、main方法</strong><br>main方法必须声明为<font color="#CD5555">public</font>。</p>
<h4 id="✎✎数据类型"><a href="#✎✎数据类型" class="headerlink" title="✎✎数据类型"></a><center><font color="#36648B">✎✎</font><br><font color="#36648B">数据类型</font></center></h4><p>在Java中，一共有<font color="#CD5555">8种</font>基本类型，其中<font color="#CD5555">4种</font>整型、<font color="#CD5555">2种</font>浮点类型、<font color="#CD5555">1种</font>字符类型char、<font color="#CD5555">1种</font>boolean类型。</p>
<p><strong>1、整型</strong><br>整型用于表示没有小数部分的数值，它允许是负数。在Java中，整型的范围与与进行Java代码的机器无关。具体内容如下:</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">存储需求(单位：byte)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">byte</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">short</td>
<td style="text-align:center">2</td>
</tr>
<tr>
<td style="text-align:center">int</td>
<td style="text-align:center">4</td>
</tr>
<tr>
<td style="text-align:center">long</td>
<td style="text-align:center">8</td>
</tr>
</tbody>
</table>
<p><strong>2、长整型数值</strong></p>
<ul>
<li>长整型数值有一个<code>后缀L</code>(如40000000000L)。</li>
<li>十六进制数值有一个<code>前缀0x</code>（如0xCAFE）。</li>
<li>八进制有一个<code>前缀0</code>，(如010对应八进制中的8)，但是很容易混淆，所以<font color="#CD5555">最好不要用</font>。</li>
<li>二进制有一个<code>前缀0b</code>（从java7开始，如0b1001就是9）。</li>
</ul>
<p>从java7开始还可以为数字字面量加下划线（如1_000_000）方便阅读，java编译器会去除这些下划线。<br>Java没有任何无符号类型(unsigned)。</p>
<p><strong>3、浮点类型</strong><br>浮点类型用于表示有小数部分的数值。在Java中有两种浮点类型。如下表:</p>
<table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">存储需求(单位：byte)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">float</td>
<td style="text-align:center">4</td>
</tr>
<tr>
<td style="text-align:center">double</td>
<td style="text-align:center">8</td>
</tr>
</tbody>
</table>
<p>double的数值精度是float类型的两倍，所以也被称为双精度数值。<br>float类型的数值有一个<code>后缀F</code>（例如3.14F）。没有后缀F的浮点数值（如3.14）<font color="#CD5555">默认为double</font>类型。(<code>3.14D</code>也表示double类型)。<br>jdk5.0中，可以用<font color="#CD5555">十六进制表示浮点数值</font>。例如，0.125可以表示成<code>0x1.0p-3</code>，在十六进制表示法中，使用p表示指数而不是e。尾数采用十六进制，指数采用十进制。且指数的基数是2（p是2）而不是10。<br>所有的浮点数值计算都遵循<font color="#CD5555">IEEE754规范</font>。</p>
<p><font color="#36648B">double在内存里的表现形式</font><br><img src="/2019/06/14/Java核心技术卷1_03_Java的基本程序设计结构/double在内存里的表现形式.jpeg" alt=""></p>
<p><font color="#36648B">float在内存里的表现形式</font><br><img src="/2019/06/14/Java核心技术卷1_03_Java的基本程序设计结构/float在内存里的表现形式.jpeg" alt=""></p>
<ul>
<li>第一位s代表符号为，1代表负数，0代表正数。</li>
<li>第二个域是指数域。 单精度数的偏差值为<font color="#CD5555">-127</font>，而双精度double类型的偏差值为<font color="#CD5555">-1023</font>。</li>
<li>第三个域为尾数域。 尾数为1.xxxx…xxx的形式。</li>
</ul>
<p><font color="#36648B">计算公式（双精度）</font><br><img src="/2019/06/14/Java核心技术卷1_03_Java的基本程序设计结构/计算公式.png" alt=""></p>
<p><font color="#36648B">Demo：将存储在内存的2进制转换为float类型</font><br><img src="/2019/06/14/Java核心技术卷1_03_Java的基本程序设计结构/demo题目.png" alt=""></p>
<ul>
<li>s：1 -&gt; 表示负数。 </li>
<li>e：10000010 -&gt; 130 -&gt; (130-127) = 3,也即尾数部分小数点向右移3位。 </li>
<li>m：10110000000000000000000,尾数加上前面省略的1和小数点为：1.10110000000000000000000。</li>
<li>现在三个部分都已经算出来了，通过指数值调整小数点的位置，得到结果为：1101.10000000000000000000。 </li>
<li>转换成10进制,整数部分为：1×2^3+1×2^2+1×2^0 = 13; 小数部分为：1×2^-1 = 0.5。</li>
<li>最后整数部分加上小数部分，再加上符号，所表示的实数就是：−13.5。</li>
</ul>
<p><font color="#36648B">用于表示溢出和出错情况的三个特殊的浮点数值</font></p>
<ul>
<li>正无穷大 -&gt; <code>Double.POSITIVE_INFINITY</code></li>
<li>负无穷大 -&gt; <code>Double.NEGATIVE_INFINITY</code></li>
<li>NaN（不是一个数字）-&gt; <code>Double.NaN</code></li>
</ul>
<p>所有非数值的数字都是<font color="#CD5555">不相同的</font>，所以不能像下面这样检测一个特定值是都等于Double.NaN。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(x == Double.NaN)</span><br></pre></td></tr></table></figure></p>
<p>但可以用以下代码判断是不是NaN:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(Double.isNaN(x))</span><br></pre></td></tr></table></figure></p>
<p><font color="#36648B">浮点数值不适用于出现舍入误差的金融计算中（带小数点的计算）</font><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="number">2.0</span>-<span class="number">1.1</span>);</span><br></pre></td></tr></table></figure></p>
<p>输出的将会是 0.8999999999999999。<br>其主要原因是浮点数值采用二进制系统表示，而在二进制系统中<font color="#CD5555">无法精确的表示分数1/10</font>。</p>
<p><font color="#36648B">小数转换二进制的方法</font><br>十进制数的整数位是二进制数的整数位，十进制数的小数位是二进制数的小数位。两部分分开转换。</p>
<ul>
<li>整数部分。除以2取余，逆序排列。</li>
<li>小数部分。乘2取整，顺序排列。</li>
</ul>
<p><font color="#36648B">Demo： 十进制的0.1转换为二进制</font><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0.1 × 2 = 0.2 ......0</span><br><span class="line">0.2 × 2 = 0.4 ......0</span><br><span class="line">0.4 × 2 = 0.8 ......0</span><br><span class="line">0.8 × 2 = 1.6.......1</span><br><span class="line">0.6 × 2 = 1.2.......1</span><br><span class="line">0.2 × 2 = 0.4.......0</span><br><span class="line">......无限循环</span><br></pre></td></tr></table></figure></p>
<p>从上面过程可以知道，在将一个十进制的小数的小数部分转换为二进制的小数时，<font color="#CD5555">除非最后的一位是5，否则是不可能乘尽的，</font>也就意味着这个十进制的小数是无法用二进制来精确表示的。<br>若需要在数值计算中不含有任何误差，就应该使用<code>BigDecimal</code>类。</p>
<p><font color="#36648B">问题集锦</font></p>
<ul>
<li>double类型的计算中有时精确有时不精确的问题。</li>
<li>直接赋值小数给double类型，按道理来讲尾数不为5的应该都表示不了，但实际上可以表示。</li>
<li>@see <a href="https://www.zhihu.com/question/56545018" target="_blank" rel="noopener">https://www.zhihu.com/question/56545018</a> 这个问题里怎么知道一个double有2个近似值，从而取有效位比较小的那个近似值。</li>
</ul>
<p><strong>4、char类型</strong><br>char类型用来表示单个字符，通常用来表示字符常量。<br><code>&#39;A&#39;</code>是编码65对应的字符常量。<code>&quot;A&quot;</code>是一个包含字符A的字符串。<br>Unicode编码单元可以表示为<font color="#CD5555">十六进制值</font>，范围从<code>\u0000</code>到<code>\uffff</code>。<br>char类型是<font color="#CD5555">基于Unicode编码</font>的，所以占用两个字节。</p>
<p>用于表示特殊字符的转义序列符如下:</p>
<table>
<thead>
<tr>
<th style="text-align:center">转义序列</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">Unicode值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>\b</code></td>
<td style="text-align:center">退格</td>
<td style="text-align:center">\u0008</td>
</tr>
<tr>
<td style="text-align:center"><code>\t</code></td>
<td style="text-align:center">制表</td>
<td style="text-align:center">\u0009</td>
</tr>
<tr>
<td style="text-align:center"><code>\n</code></td>
<td style="text-align:center">换行</td>
<td style="text-align:center">\u000a</td>
</tr>
<tr>
<td style="text-align:center"><code>\r</code></td>
<td style="text-align:center">回车</td>
<td style="text-align:center">\u000d</td>
</tr>
<tr>
<td style="text-align:center"><code>\&quot;</code></td>
<td style="text-align:center">双引号</td>
<td style="text-align:center">\u0002</td>
</tr>
<tr>
<td style="text-align:center"><code>\&#39;</code></td>
<td style="text-align:center">单引号</td>
<td style="text-align:center">\u0027</td>
</tr>
<tr>
<td style="text-align:center"><code>\\</code></td>
<td style="text-align:center">反斜杠</td>
<td style="text-align:center">\u005c</td>
</tr>
</tbody>
</table>
<p>所有的转义字符都必须出现在字符常量或字符串的引号内，如<code>&#39;\u2122&#39;</code>或<code>&#39;Hello\n&#39;</code>。</p>
<p><strong>5、boolean 类型</strong><br>数值型和布尔值之间不能进行相互转换。</p>
<h4 id="✎✎✎变量"><a href="#✎✎✎变量" class="headerlink" title="✎✎✎变量"></a><center><font color="#36648B">✎✎✎</font><br><font color="#36648B">变量</font></center></h4><p>变量名必须是一个<font color="#CD5555">以字母开头</font>的由字母或数字构成的序列。其中字母包括<code>&#39;A&#39;~&#39;Z&#39;、&#39;a&#39;~&#39;z&#39;、&#39;_&#39;、&#39;$&#39;</code>或在某种语言中代表字母的任何Unicode字符(实际上并不能用Unicode)，变量名的长度没有限制。<br>尽管$是一个合法的Java字符，但最好不要用。它只用在Java编译器或其他工具生成的名字中。</p>
<h4 id="✎✎✎✎常量"><a href="#✎✎✎✎常量" class="headerlink" title="✎✎✎✎常量"></a><center><font color="#36648B">✎✎✎✎</font><br><font color="#36648B">常量</font></center></h4><p>关键字final表示这个变量只能被赋值一次，赋值以后就不可以再被更改了。</p>
<h4 id="✎✎✎✎✎运算符"><a href="#✎✎✎✎✎运算符" class="headerlink" title="✎✎✎✎✎运算符"></a><center><font color="#36648B">✎✎✎✎✎</font><br><font color="#36648B">运算符</font></center></h4><p>当参与<code>/</code>运算的两个操作数都是整数时，表示整数除法，否则表示浮点除法。<br>整数除以0将会产生一个异常，而浮点（不包括0.0）除以0将会得到无穷大结果。<br>计算0.0/0或者负数的平方根结果为<code>NaN</code>。</p>
<h4 id="✎✎✎✎✎✎位运算符"><a href="#✎✎✎✎✎✎位运算符" class="headerlink" title="✎✎✎✎✎✎位运算符"></a><center><font color="#36648B">✎✎✎✎✎✎</font><br><font color="#36648B">位运算符</font></center></h4><p><strong>1、位运算符列表</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">符号</th>
<th style="text-align:center">名称</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">&amp;</td>
<td style="text-align:center">与</td>
</tr>
<tr>
<td style="text-align:center">I</td>
<td style="text-align:center">或</td>
</tr>
<tr>
<td style="text-align:center">^</td>
<td style="text-align:center">异或</td>
</tr>
<tr>
<td style="text-align:center">~</td>
<td style="text-align:center">非</td>
</tr>
<tr>
<td style="text-align:center">&lt;&lt;</td>
<td style="text-align:center">左位移运算符</td>
</tr>
<tr>
<td style="text-align:center">&gt;&gt;</td>
<td style="text-align:center">右位移运算符</td>
</tr>
<tr>
<td style="text-align:center">&lt;&lt;&lt;</td>
<td style="text-align:center">无符号右移运算符</td>
</tr>
</tbody>
</table>
<p>运算符中，除~以外，其他均为二元运算符。操作数只能为整型和字符型数据。</p>
<p><strong>2、位运算符运算规则</strong></p>
<p><strong>与运算</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">操作数1</th>
<th style="text-align:center">操作数2</th>
<th style="text-align:center">结果</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>
<p><strong>或运算</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">操作数1</th>
<th style="text-align:center">操作数2</th>
<th style="text-align:center">结果</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>
<p><strong>非运算</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">操作数</th>
<th style="text-align:center">结果</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
</tr>
</tbody>
</table>
<p><strong>异或运算</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">操作数1</th>
<th style="text-align:center">操作数2</th>
<th style="text-align:center">结果</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">0</td>
</tr>
</tbody>
</table>
<p><strong>左位移</strong><br>符号位不变，低位补0。</p>
<p><strong>右位移</strong><br>符号位不变，并用符号位补溢出的高位。</p>
<p><strong>无符号右移</strong><br>符号位也跟着改变，高位补0。</p>
<p>没有无符号左移的运算符。<br>&amp;与|运算符与&amp;&amp;和||非常相似，只是不按短路方式计算。</p>
<h4 id="✎✎✎✎✎✎✎数学函数"><a href="#✎✎✎✎✎✎✎数学函数" class="headerlink" title="✎✎✎✎✎✎✎数学函数"></a><center><font color="#36648B">✎✎✎✎✎✎✎</font><br><font color="#36648B">数学函数</font></center></h4><p>在Math类中，为了达到最快的性能，所有方式都使用计算机浮点单元中的例程。如果想要结果完全正确，那么就应该使用<code>StrictMath</code>类。</p>
<p><strong>1、数值类型之间的合法转换</strong><br><img src="/2019/06/14/Java核心技术卷1_03_Java的基本程序设计结构/数值转换.png" alt=""></p>
<p>5个实心箭头表示<font color="#CD5555">无信息丢失</font>的转换。3个虚箭头表示<font color="#CD5555">可能有精度损失</font>的转换。<br>当用上面两个数值进行二元操作时：</p>
<ul>
<li>如果两个操作数有一个是double类型的，另一个操作数就会转换成double类型。</li>
<li>否则如果其中一个操作数是float类型，另一个操作数就会转换成float类型。</li>
<li>否则如果其中一个操作数是long类型，另一个操作数就会转换成long类型。</li>
<li>否则，两个操作数都将被转换成int类型。</li>
</ul>
<p><strong>2、强制转换</strong><br>如果试图将一个数值从一种类型强制转换成另一种类型而又超出了目标类型的表示范围，结果就会被截断成一个完全不同的值。</p>
<blockquote>
<p>e.g (byte)300的结果为44。</p>
</blockquote>
<h4 id="✎✎✎✎✎✎✎✎java字符串"><a href="#✎✎✎✎✎✎✎✎java字符串" class="headerlink" title="✎✎✎✎✎✎✎✎java字符串"></a><center><font color="#36648B">✎✎✎✎✎✎✎✎</font><br><font color="#36648B">java字符串</font></center></h4><p>Java字符串就是Unicode的字符序列。<br>由于不能修改Java字符串中的字符，所以在Java文档中将String类兑现称为不可变字符串。<br>不可变字符串却有一个优点：编译器可以让<font color="#CD5555">字符串共享</font>。</p>
<p>在Java的栈中，有共享池的概念，会把一些常量放到这个共享池中，包括字符串常量和基本类型常量。共享的操作在<font color="#CD5555">编译时</font>由编译器完成的，可以节省内存，并提高效率。例如语句<code>String str = &quot;hello&quot;</code>，首先在栈中创建字符串引用变量str，再看看常量池中有没有”hello”，如果有str就直接指向它，没有就创建”hello”并放在常量池中，然后指向它。(对于int之类的基本类型的变量也差不多都是这样的。)<br>而对于<code>String str =  new String(&quot;hello&quot;)</code>，则是创建新的对象，并放在堆内存中。是在<font color="#CD5555">runtime</font>的时候分配的。这样做效率和节省内存的方面不如<code>String str = &quot;hello&quot;</code>，但是更灵活。如果在编译时不知道要创建什么样的字符串，就只能运行时创建了。</p>
<p><strong>1、代码点与代码单元</strong><br>代码点 &gt;= 代码单元。<br>Java字符串由char序列组成。char数据类型是一个采用UTF-16编码表示Unicode代码点的代码单元。<br> 大多数的常用Unicode字符使用一个代码单元就可以表示，而辅助字符需要一对代码单元表示。<br>String的length方法将返回采用UTF-16编码表示的代码单元数量。而想要得到实际的长度，即代码点数量。需要如下方法:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> count = str.codePointCount(<span class="number">0</span>,str.length());</span><br></pre></td></tr></table></figure></p>
<p>调用<code>charAt(n)</code>方法返回的是位置n的代码单元。</p>
<p><strong>2、遍历代码点的两种方法</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">String str = <span class="string">"\uD835\uDD6B"</span>+<span class="string">"a"</span>;</span><br><span class="line"><span class="comment">//代码点数量</span></span><br><span class="line"><span class="keyword">int</span> count = str.codePointCount(<span class="number">0</span>,str.length());</span><br><span class="line">System.out.println(<span class="string">"code length :"</span>+count);  <span class="comment">//2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(i&lt;count)&#123;</span><br><span class="line">    <span class="comment">//得到第i个代码点</span></span><br><span class="line">    <span class="keyword">int</span> index = str.offsetByCodePoints(<span class="number">0</span>,i);</span><br><span class="line">    <span class="keyword">int</span> cp = str.codePointAt(index);</span><br><span class="line">    System.out.println(Character.toChars(cp));  <span class="comment">//𝕫 、a</span></span><br><span class="line">    i++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一个代码点的index</span></span><br><span class="line"><span class="keyword">int</span> index = str.offsetByCodePoints(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">while</span>(index&lt;str.length())&#123;</span><br><span class="line">    <span class="keyword">int</span> cp = str.codePointAt(index);</span><br><span class="line">    System.out.println(Character.toChars(cp));   <span class="comment">//𝕫 、a</span></span><br><span class="line">    <span class="keyword">if</span>(Character.isSupplementaryCodePoint(cp))&#123;</span><br><span class="line">        index+=<span class="number">2</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        index++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3、构建字符串</strong></p>
<p><font color="#36648B">StringBuilder与StringBuffer的区别</font></p>
<ul>
<li>这两个类的API是相同的。</li>
<li>StringBuffer的效率比较低，但是是线程安全的。</li>
</ul>
<p>Java8中，用String拼接字符串默认使用<code>StringBuilder</code>进行拼接。</p>
<p>可以使用标签的形式跳出循环，但是只能跳出语句不能跳进语句。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">label:</span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">if</span>(condition) <span class="keyword">break</span> label;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="✎✎✎✎✎✎✎✎✎数组"><a href="#✎✎✎✎✎✎✎✎✎数组" class="headerlink" title="✎✎✎✎✎✎✎✎✎数组"></a><center><font color="#36648B">✎✎✎✎✎✎✎✎✎</font><br><font color="#36648B">数组</font></center></h4><p>创建一个数字数组时，所有元素都初始化为<code>0</code>。boolean数组的元素都会初始化为<code>false</code>。对象数组的元素则初始化为一个特殊值<code>null</code>。<br>一旦创建了数组，就不能再改变它的大小。</p>
<p><strong>1、打印数组中的所有值</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Arrays.toString(a);</span><br></pre></td></tr></table></figure></p>
<p><strong>2、数组初始化</strong></p>
<p><font color="#36648B">静态初始化</font><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] smallPrimes = &#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>&#125;;</span><br></pre></td></tr></table></figure></p>
<p><font color="#36648B">动态初始化</font><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] smallPrimes = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</span><br><span class="line">smallPrimes[<span class="number">0</span>] = <span class="number">1</span>;</span><br></pre></td></tr></table></figure></p>
<p><font color="#36648B">匿名数组</font><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>&#125; ;</span><br></pre></td></tr></table></figure></p>
<p>Java中数组长度可以为0。<br>数组长度为0与null不同。</p>
<p><strong>3、数组拷贝</strong><br>在Java中，允许将一个数组变量拷贝给另一个数组变量。这时，两个变量将引用同一个数组。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] luckyNumbers = smallPrimes;</span><br><span class="line">luckyNumbers[<span class="number">5</span>] = <span class="number">12</span> <span class="comment">//now smallPrimes[5] is also 12</span></span><br></pre></td></tr></table></figure></p>
<p>如果只是希望拷贝数组的值而不是变量，可以用<code>Arrays</code>类的<code>copyOf</code>方法。</p>
<p><strong>4、数组排序</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Arrays.sort(a);</span><br></pre></td></tr></table></figure></p>
<p>这个方法使用了优化的<font color="#CD5555">快速排序</font>算法。</p>
<p><strong>5、二维数组</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[][] magicSquare =</span><br><span class="line">   &#123;</span><br><span class="line">       &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;,</span><br><span class="line">       &#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;</span><br><span class="line">   &#125;;</span><br></pre></td></tr></table></figure></p>
<p>快速打印一个二维数组可以用<code>Arrays.deepToString(a)</code>方法。</p>
<p><strong>6、不规则数组</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[][] odds = <span class="keyword">new</span> <span class="keyword">int</span>[NMAX + <span class="number">1</span>][];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> n = <span class="number">0</span>;n&lt;=NMAX; n++)</span><br><span class="line">    odds[n] = <span class="keyword">new</span> <span class="keyword">int</span>[n + <span class="number">1</span>];</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/05/Spring Cloud与Docker微服务架构实战_08_使用Zuul构建微服务网关/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aFightz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aFightz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/05/Spring Cloud与Docker微服务架构实战_08_使用Zuul构建微服务网关/" class="post-title-link" itemprop="http://yoursite.com/page/7/index.html">08 | 使用Zuul构建微服务网关</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-05 13:51:29" itemprop="dateCreated datePublished" datetime="2019-06-05T13:51:29+08:00">2019-06-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-01-07 16:21:41" itemprop="dateModified" datetime="2020-01-07T16:21:41+08:00">2020-01-07</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Java/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Java/Spring/Spring-Cloud与Docker微服务架构实战/" itemprop="url" rel="index"><span itemprop="name">Spring Cloud与Docker微服务架构实战</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="✎Zuul使用的客户端"><a href="#✎Zuul使用的客户端" class="headerlink" title="✎Zuul使用的客户端"></a><center><font color="#36648B">✎</font><br><font color="#36648B">Zuul使用的客户端</font></center></h4><ul>
<li>Apache HTTP Client(<font color="#CD5555">默认</font>)</li>
<li>RestClient(设置<code>ribbon.restclient.enabled=true</code>)</li>
<li>okhttp3.OkHttpClient(设置<code>ribbon.okhttp.enabled=true</code>)   </li>
</ul>
<h4 id="✎✎Zuul的整合"><a href="#✎✎Zuul的整合" class="headerlink" title="✎✎Zuul的整合"></a><center><font color="#36648B">✎✎</font><br><font color="#36648B">Zuul的整合</font></center></h4><ul>
<li>引入<code>spring-cloud-starter-netfilx-zuul</code></li>
<li>在启动类上添加<code>@EnbaleZuulProxy</code></li>
<li>在配置加上Eureka注册中心的地址（zuul整合了Ribbon与Hystrix）。</li>
<li>访问形式<code>http://ZUUL_HOST:ZUUL_PROT/微服务名称/**</code></li>
</ul>
<h4 id="✎✎✎管理端点"><a href="#✎✎✎管理端点" class="headerlink" title="✎✎✎管理端点"></a><center><font color="#36648B">✎✎✎</font><br><font color="#36648B">管理端点</font></center></h4><ul>
<li>通过<code>/routes</code>访问端点。</li>
<li>通过<code>/routes?format=details</code>可以访问更多的详细信息。</li>
<li>使用GET方式请求，可以得到当前映射的路由列表。</li>
<li><p>使用POST方式请求，强制刷新当前路由。</p>
</li>
<li><p>通过<code>/filters</code> 返回Zuul中所有的过滤器详情。</p>
</li>
</ul>
<h4 id="✎✎✎✎路由配置"><a href="#✎✎✎✎路由配置" class="headerlink" title="✎✎✎✎路由配置"></a><center><font color="#36648B">✎✎✎✎</font><br><font color="#36648B">路由配置</font></center></h4><p><strong>1、配置指定微服务的访问路径</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zuul.routes.xx-service-name: /user/**</span><br></pre></td></tr></table></figure></p>
<p>或<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zuul:</span><br><span class="line">   routes:</span><br><span class="line">      user-route:     #user-route只是给路由起名字，可以随意起</span><br><span class="line">         service-id: xx-service-name</span><br><span class="line">         path: /user/**</span><br></pre></td></tr></table></figure></p>
<p><strong>2、忽略指定微服务，只代理其他服务</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zuul.ignored-services: xx-service-name</span><br></pre></td></tr></table></figure></p>
<p><strong>3、忽略所有微服务，只代理指定服务</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zuul:</span><br><span class="line">  ignored-services: &apos;*&apos;</span><br><span class="line">  routes:</span><br><span class="line">      xx-service-name: /user/**</span><br></pre></td></tr></table></figure></p>
<p><strong>4、指定path和url</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#将 /user/**映射到http//localhost:8080/,但是会破坏ribbon与hystrix</span><br><span class="line">zuul:</span><br><span class="line">   routes:</span><br><span class="line">      user-route:</span><br><span class="line">         path: /user/**</span><br><span class="line">         url: http//localhost:8080/</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#不破坏ribbon与hystrix</span><br><span class="line">zuul:</span><br><span class="line">   routes:</span><br><span class="line">      user-route:    </span><br><span class="line">         service-id: xx-service-name</span><br><span class="line">         path: /user/**</span><br><span class="line">         </span><br><span class="line">ribbon:</span><br><span class="line">   eureka:</span><br><span class="line">      enabled: false</span><br><span class="line">xx-service-name:</span><br><span class="line">   ribbon:</span><br><span class="line">      listOfServers: localhost:8000,localhost:8001</span><br></pre></td></tr></table></figure>
<p><strong>5、可借助PatternServiceRouteMapper实现正则映射。</strong></p>
<p><strong>6、路由前缀</strong></p>
<ul>
<li><code>zuul.strip-prefix</code>决定在访问时是否带上<code>zuul.prefix</code>。</li>
<li><code>zuul.routes.&lt;service-name&gt;.strip-prefix</code>决定在访问时是否带上<code>zuul.routes.&lt;service-name&gt;.path</code></li>
</ul>
<p><strong>7、忽略某些路径</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#在访问service-name这个服务时，会忽略/admin/路径。</span><br><span class="line">zuul:</span><br><span class="line">   ignoredPatterns: /**/admin/**</span><br><span class="line">   routes:</span><br><span class="line">      &lt;service-name&gt;： /user/**</span><br></pre></td></tr></table></figure></p>
<p><strong>8、本地转发</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#在访问/path-a/**时，会转发到/path-b。</span><br><span class="line">zuul:</span><br><span class="line">   routes:</span><br><span class="line">      &lt;route-name&gt;:</span><br><span class="line">         path: /path-a/**</span><br><span class="line">         url: forward:/path-b</span><br></pre></td></tr></table></figure></p>
<h4 id="✎✎✎✎✎ZUUL日志级别"><a href="#✎✎✎✎✎ZUUL日志级别" class="headerlink" title="✎✎✎✎✎ZUUL日志级别"></a><center><font color="#36648B">✎✎✎✎✎</font><br><font color="#36648B">ZUUL日志级别</font></center></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.level.com.netflix</span><br></pre></td></tr></table></figure>
<h4 id="✎✎✎✎✎✎ZUUL的安全与Header"><a href="#✎✎✎✎✎✎ZUUL的安全与Header" class="headerlink" title="✎✎✎✎✎✎ZUUL的安全与Header"></a><center><font color="#36648B">✎✎✎✎✎✎</font><br><font color="#36648B">ZUUL的安全与Header</font></center></h4><p><strong>1、为特定service设置敏感header列表</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zuul.routes.&lt;service-name&gt;.sentive-headers</span><br></pre></td></tr></table></figure>
<p><strong>2、覆盖全局配置</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zuul.routes.*.sentive-headers</span><br></pre></td></tr></table></figure></p>
<p><strong>3、忽略（丢弃）Header</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zuul.ignored-headers</span><br></pre></td></tr></table></figure></p>
<p>ignored-headers默认为空，但是在在zuul配合spring security时默认值会是Expires等<font color="#CD5555">Spring Security的Header</font>，如果需要使用它们，则可以设置<code>zuul.ignoreSecurityHeaders</code>为false。</p>
<h4 id="✎✎✎✎✎✎Zuul与文件上传"><a href="#✎✎✎✎✎✎Zuul与文件上传" class="headerlink" title="✎✎✎✎✎✎Zuul与文件上传"></a><center><font color="#36648B">✎✎✎✎✎✎</font><br><font color="#36648B">Zuul与文件上传</font></center></h4><ul>
<li>文件小于1M。无须任何处理。</li>
<li>文件大于10M。在访问zuul时需要加上<code>zuul/</code>前缀。</li>
<li>对于超大文件，要将hystrix和ribbon的超时时间设置长一点。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds</span><br><span class="line">ribbon.ConnectTimeout.ReadTimeout</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="✎✎✎✎✎✎✎Zuul的过滤器"><a href="#✎✎✎✎✎✎✎Zuul的过滤器" class="headerlink" title="✎✎✎✎✎✎✎Zuul的过滤器"></a><center><font color="#36648B">✎✎✎✎✎✎✎</font><br><font color="#36648B">Zuul的过滤器</font></center></h4><p><strong>1、过滤器类型</strong></p>
<ul>
<li>PRE</li>
<li>ROUTING</li>
<li>POST</li>
<li>ERROR</li>
</ul>
<p><strong>2、ZUUL请求的生命周期图</strong></p>
<p><strong>3、编写zuul过滤器</strong></p>
<ul>
<li>继承抽象类<code>ZuulFilter</code>，实现其抽象方法。</li>
<li>将这个新编写的filter注册成一个bean。</li>
</ul>
<p><strong>4、可使用过滤器做以下事情</strong></p>
<ul>
<li>限流</li>
<li>安全认证（传播安全token）</li>
<li>灰度发布</li>
</ul>
<p><strong>5、禁用过滤器</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zuul.&lt;SimpleClassName&gt;.&lt;filterType&gt;.disable = true</span><br></pre></td></tr></table></figure></p>
<p><strong>6、注解</strong><br><code>@EnableZuulProxy</code>是<code>@EnableZuulServer</code>的增强版。</p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/04/Spring Cloud与Docker微服务架构实战_07_使用Hystrix实现微服务的容错处理/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aFightz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aFightz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/04/Spring Cloud与Docker微服务架构实战_07_使用Hystrix实现微服务的容错处理/" class="post-title-link" itemprop="http://yoursite.com/page/7/index.html">07 | 使用Hystrix实现微服务的容错处理</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-04 17:35:40" itemprop="dateCreated datePublished" datetime="2019-06-04T17:35:40+08:00">2019-06-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-01-07 16:21:41" itemprop="dateModified" datetime="2020-01-07T16:21:41+08:00">2020-01-07</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Java/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Java/Spring/Spring-Cloud与Docker微服务架构实战/" itemprop="url" rel="index"><span itemprop="name">Spring Cloud与Docker微服务架构实战</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="✎断路器状态转换图"><a href="#✎断路器状态转换图" class="headerlink" title="✎断路器状态转换图"></a><center><font color="#36648B">✎</font><br><font color="#36648B">断路器状态转换图</font></center></h4><p><img src="/2019/06/04/Spring Cloud与Docker微服务架构实战_07_使用Hystrix实现微服务的容错处理/断路器状态转换图.png" alt=""></p>
<h4 id="✎✎整合Hystrix"><a href="#✎✎整合Hystrix" class="headerlink" title="✎✎整合Hystrix"></a><center><font color="#36648B">✎✎</font><br><font color="#36648B">整合Hystrix</font></center></h4><ul>
<li>引入<code>spring-cloud-starter-netflix-hystrix</code></li>
<li>在启动类上添加<code>@EnableCircuitBreaker</code>或<code>@EnbaleHystrix</code></li>
<li><p>在Mapping方法上添加注解:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand</span>(fallbackMethod = <span class="string">"findByIdFallback"</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong><font color="#CD5555">findByIdFallback</font></strong>是一个自定义方法，若业务发生异常则则回调用此方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">findByIdFallback</span><span class="params">(Long id)</span></span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>@HystrixCommand</code>下的<code>commandProperties</code>可配置<font color="#CD5555">超时</font>等属性。</p>
</li>
<li><p>findByIdFallback的参数与Mapping注解下的方法参数需<font color="#CD5555">一致</font>，若想对异常进行一些处理，可以再加上<font color="#CD5555">Throwable</font>参数，如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">findByIdFallback</span><span class="params">(Long id ,Throwable e)</span></span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>若在某些异常情况下，不回调findByIdFallback方法，可以通过<code>@HystrixCommand</code>下的<code>ignoreExceptions</code>属性去设置。</p>
</li>
</ul>
</li>
</ul>
<h4 id="✎✎✎Hystrix与Actuator"><a href="#✎✎✎Hystrix与Actuator" class="headerlink" title="✎✎✎Hystrix与Actuator"></a><center><font color="#36648B">✎✎✎</font><br><font color="#36648B">Hystrix与Actuator</font></center></h4><p>可以通过Actuator去监控Hystrix状态。服务正常时，状态是up，但是当我们关闭服务时再访问，Hystrix会由于业务失败执行回退逻辑，此时Hystrix的状态仍旧是up，<font color="#CD5555">这是由于失败率还没达到阈值，断路器还未被打开</font>（默认是<font color="#CD5555">5S内20次失败</font>）。</p>
<h4 id="✎✎✎✎Hystrix线程隔离策略"><a href="#✎✎✎✎Hystrix线程隔离策略" class="headerlink" title="✎✎✎✎Hystrix线程隔离策略"></a><center><font color="#36648B">✎✎✎✎</font><br><font color="#36648B">Hystrix线程隔离策略</font></center></h4><ul>
<li>Hystrix线程隔离策略有两种：<ul>
<li><code>THREAD</code>：HystrixCommand将在将在<font color="#CD5555">单独的线程</font>执行。</li>
<li><code>SEMAPHORE</code>：HystrixCommand将在<font color="#CD5555">调用线程</font>上执行。</li>
</ul>
</li>
<li>Hystrix<font color="#CD5555">默认的策略</font>是<code>THREAD</code>。</li>
<li>在同一个线程，才能访问request上下文，所以使用THREAD策略会出现访问不到上下文的情况。</li>
<li>可通过<code>execution.isolation.strategy</code>属性指定隔离策略。</li>
</ul>
<h4 id="✎✎✎✎✎Feign使用Hystrix"><a href="#✎✎✎✎✎Feign使用Hystrix" class="headerlink" title="✎✎✎✎✎Feign使用Hystrix"></a><center><font color="#36648B">✎✎✎✎✎</font><br><font color="#36648B">Feign使用Hystrix</font></center></h4><p>Srping Cloud默认已经为Feign整合了Hystrix。</p>
<p><strong>1、feign开启hystrix</strong></p>
<ul>
<li>设置<code>feign.hystrix.enbaled=true</code></li>
<li>为FeignClient接口创建一个实现类。</li>
<li><p>然后在FeignClient接口上使用<code>@FeignClient</code>的<code>fallback</code>属性指定<font color="#CD5555">实现类</font>，即可实现hystrix的回滚功能。</p>
</li>
<li><p>如果需要知道回退错误类型，则：</p>
<ul>
<li><p>实现<code>FallbackFactory&lt;FeignClient&gt;</code>类，复写create方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> FeignClient <span class="title">create</span><span class="params">(Throwable cause)</span></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在FeignClient接口上使用<code>@FeignClient</code>的<code>fallbackFactory</code>属性指定实现类。</p>
</li>
</ul>
</li>
</ul>
<p><strong>2、为指定Feign禁用Hystrix</strong><br>FeignClient默认是不开启Hystrix的，只是我们之前在全局加了开启Hystrix配置。所以要为指定Feign禁用Hystrix，只需要为特定的Feign注入一个初始的FeignClient(没开启Hystrix)而不注入全局的FeignClient即可。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">xxxConfiguration</span></span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Feign.<span class="function">Builder <span class="title">feignBulider</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Feign.builder();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>之后在FeignClient的<code>configuration</code>属性指定这个配置即可。</p>
<h4 id="✎✎✎✎✎✎Hystrix的监控"><a href="#✎✎✎✎✎✎Hystrix的监控" class="headerlink" title="✎✎✎✎✎✎Hystrix的监控"></a><center><font color="#36648B">✎✎✎✎✎✎</font><br><font color="#36648B">Hystrix的监控</font></center></h4><ul>
<li>只要添加了actuator模块，就能通过<code>/hystrix.stream</code>看到相应的监控信息。</li>
<li>可使用<code>Hystrix Dashborad</code>可视化监控数据。</li>
<li>可使用<code>Turbine</code>聚合监控数据。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/04/Spring Cloud与Docker微服务架构实战_06_使用Feign实现声明式REST调用/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aFightz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aFightz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/04/Spring Cloud与Docker微服务架构实战_06_使用Feign实现声明式REST调用/" class="post-title-link" itemprop="http://yoursite.com/page/7/index.html">06 | 使用Feign实现声明式REST调用</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-04 16:47:51" itemprop="dateCreated datePublished" datetime="2019-06-04T16:47:51+08:00">2019-06-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-01-07 16:21:41" itemprop="dateModified" datetime="2020-01-07T16:21:41+08:00">2020-01-07</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Java/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Java/Spring/Spring-Cloud与Docker微服务架构实战/" itemprop="url" rel="index"><span itemprop="name">Spring Cloud与Docker微服务架构实战</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="✎整合Feign"><a href="#✎整合Feign" class="headerlink" title="✎整合Feign"></a><center><font color="#36648B">✎</font><br><font color="#36648B">整合Feign</font></center></h4><ul>
<li>添加Feign的依赖<code>spring-cloud-starter-openfeign</code></li>
<li><p>创建Feign接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient</span>(name = <span class="string">"service-name"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserFeignClient</span></span>&#123;</span><br><span class="line">   <span class="meta">@RequestMapping</span>(value = <span class="string">"/&#123;id&#125;"</span> , method = RequestMethod.GET)</span><br><span class="line">   <span class="function">User <span class="title">findById</span><span class="params">(@PathVariable Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在启动类添加<code>@EnbaledFeignClients</code>注解。</p>
</li>
</ul>
<p>因为使用了Eureka，所以Ribbon会把service-name解析成注册中心列表里的服务。<br>可以使用<code>service.ribbon.listOfServers</code>属性配置服务列表。<br>也可以通过<code>@FeignClient</code>的<code>url</code>属性配置特定的地址。</p>
<h4 id="✎✎自定义Feign配置"><a href="#✎✎自定义Feign配置" class="headerlink" title="✎✎自定义Feign配置"></a><center><font color="#36648B">✎✎</font><br><font color="#36648B">自定义Feign配置</font></center></h4><p>Feign的默认配置是<code>FeignClientsConfiguration</code>。<br>可以通过<code>@FeignClient</code>的<code>configuration</code>属性自定义Feign的配置，自定义配置的优先级比FeignClientsConfiguration高。</p>
<p><strong>1、自定义配置Demo</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FeignConfiguration</span></span>&#123;</span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Contract <span class="title">feignContract</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> feign.Contract.Default();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个配置<font color="#CD5555">不能加</font><code>@Configuration</code>注解，否则如果被扫描到会被替换成全局配置。</p>
<p><strong>2、基于Http Basic认证的Demo</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FeignConfiguration</span></span>&#123;</span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> BasicAuthRequestInterceptor <span class="title">basicAuthRequestInterceptor</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> BasicAuthRequestInterceptor(<span class="string">"user"</span> , <span class="string">"password"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>3、全局配置</strong><br>用<code>@EnableFeignClients</code>的<code>defaultConfiguration</code>属性用来指定默认的配置类。</p>
<p><strong>4、配置指定名称的Feign Client</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">feign.client.config.feignName.*(各种属性)</span><br></pre></td></tr></table></figure></p>
<p><strong>5、配置通用的Feign Client</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">feign.client.config.default.*(各种属性)</span><br></pre></td></tr></table></figure></p>
<p>属性配置的方式比java配置的优先级更高，如果想让java配置的优先级更高，可以配置如下属性，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">feign.client.default-to-properties=false</span><br></pre></td></tr></table></figure></p>
<h4 id="✎✎✎手动创建一个Feigon"><a href="#✎✎✎手动创建一个Feigon" class="headerlink" title="✎✎✎手动创建一个Feigon"></a><center><font color="#36648B">✎✎✎</font><br><font color="#36648B">手动创建一个Feigon</font></center></h4><ul>
<li>FeigonClient接口上的@FeignClient注解以及启动类上的@FeigonClients移除。</li>
<li>Controller Demo<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import</span>(FeignClientsConfiguration.class)</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieController</span></span>&#123;</span><br><span class="line">   <span class="keyword">private</span> UserFeignClient userFeignClient;</span><br><span class="line">   <span class="keyword">private</span> adminFeignClient adminFeignClient;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">MovieController</span><span class="params">(Decoder decoder , Encoder encoder , Client client , Contract contract)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.userFeignClient = Feign.builder().client(client).encoder(encoder).decoder(decoder).contract(contract)</span><br><span class="line">      .requestInterceptor(<span class="keyword">new</span> BasicAuthRequestInterceptor(<span class="string">"user"</span> , <span class="string">"password1"</span>))</span><br><span class="line">      .target(UserFeignClient.class , <span class="string">"http://xxx-service/"</span>);</span><br><span class="line">      <span class="comment">//adminFeignClient类似上面</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><code>FeignClientsConfiguration</code>是Spring Cloud为Feign提供的默认配置类。</p>
<p>Feign可以设置为对请求或响应进行压缩，还能对压缩进行一些详细的设置。<br>Feign默认的日志级别是DEBUG，可以通过配置进行一些自定义的日志级别配置，甚至可以对某一特定服务进行单独的日志级别配置。</p>
<h4 id="✎✎✎构造多参数请求"><a href="#✎✎✎构造多参数请求" class="headerlink" title="✎✎✎构造多参数请求"></a><center><font color="#36648B">✎✎✎</font><br><font color="#36648B">构造多参数请求</font></center></h4><ul>
<li>使用<code>@RequestParam</code>和Map构造get的多参数请求。</li>
<li>使用<code>@RequestBody</code>构造post的多参数请求。</li>
</ul>
<h4 id="✎✎✎✎使用Feign上传文件"><a href="#✎✎✎✎使用Feign上传文件" class="headerlink" title="✎✎✎✎使用Feign上传文件"></a><center><font color="#36648B">✎✎✎✎</font><br><font color="#36648B">使用Feign上传文件</font></center></h4><ul>
<li>引入<code>feign-form</code>（需要使用它的Encoder）。</li>
<li>Hystrix的超时时间需要设长一点。不然文件还没上传完就超时了。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/04/Spring Cloud与Docker微服务架构实战_05_使用Ribbon实现客户端侧的负载均衡/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aFightz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aFightz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/04/Spring Cloud与Docker微服务架构实战_05_使用Ribbon实现客户端侧的负载均衡/" class="post-title-link" itemprop="http://yoursite.com/page/7/index.html">05 | 使用Ribbon实现客户端侧的负载均衡</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-04 16:04:21" itemprop="dateCreated datePublished" datetime="2019-06-04T16:04:21+08:00">2019-06-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-01-07 16:21:41" itemprop="dateModified" datetime="2020-01-07T16:21:41+08:00">2020-01-07</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Java/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Java/Spring/Spring-Cloud与Docker微服务架构实战/" itemprop="url" rel="index"><span itemprop="name">Spring Cloud与Docker微服务架构实战</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="✎获得当前选择的服务节点"><a href="#✎获得当前选择的服务节点" class="headerlink" title="✎获得当前选择的服务节点"></a><center><font color="#36648B">✎</font><br><font color="#36648B">获得当前选择的服务节点</font></center></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> LoadBlancerClient loadBlancerClient;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ServiceInstance instance = <span class="keyword">this</span>.loadBlancerClient.choose(<span class="string">"service-name"</span>);</span><br><span class="line">instance.getHost()/instance.getPort();</span><br></pre></td></tr></table></figure>
<h4 id="✎✎虚拟主机名称"><a href="#✎✎虚拟主机名称" class="headerlink" title="✎✎虚拟主机名称"></a><center><font color="#36648B">✎✎</font><br><font color="#36648B">虚拟主机名称</font></center></h4><p>默认情况下，虚拟主机名称即服务名称（也可通过<code>application-name</code>指定服务名称）。<br>也可配置<code>eureka.instance.virtual-host-name</code>或<code>eureka.instance.security-virtual-host-name</code>设置虚拟主机名称。<br>虚拟主机名不能含有“_”这个字符，否则会报异常。<br>不能将<code>restTemplate.getForObject(...)</code>与<code>loadBalanceClient.choose(...)</code>写在同一个方法，会有冲突。</p>
<h4 id="✎✎✎自定义Ribbon"><a href="#✎✎✎自定义Ribbon" class="headerlink" title="✎✎✎自定义Ribbon"></a><center><font color="#36648B">✎✎✎</font><br><font color="#36648B">自定义Ribbon</font></center></h4><p><strong>1、使用Java配置方式配置自定义Ribbon</strong><br>Ribbon默认的配置类是<code>RibbonClientConfiguration</code>。使用自定义配置会覆盖这个默认配置。所以我们在为某一个Ribbon设置一个自定义配置时，不应该让这个自定义配置被@ComponentScan扫描到。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RibbonConfiguration</span></span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IRule <span class="title">ribbonRule</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RandomRule();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//为特定service-name的ribbon client指定自定义配置类。</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@RibbonClient</span>(name = <span class="string">"xxx-service"</span> , configuration = </span><br><span class="line">    RibbonConfiguration.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestConfiguration</span></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也可以用<code>@RibbonClients</code>为所有Ribbon Client提供默认配置。（让@RibbonClient的配置被扫描到，不就是全局配置了？）</p>
<p><strong>2、使用属性自定义Ribbon配置</strong></p>
<p>属性的前缀是service-name.ribbon</p>
<ul>
<li>NFLoadBanlancerClassName：配置ILoadBalancer的实现类。</li>
<li>NFLoadBanlancerRuleClassName：配置IRule的实现类。</li>
<li>NFLoadBanlancerPingClassName：配置Iping的实现类。</li>
<li>NIWSServerListClassName：配置ServerList的实现类。</li>
<li>NIWSServerListFilterClassName：配置ServerListFilter的实现类。<br>属性配置的方式比Java配置方式的<font color="#CD5555">优先级更高</font>。</li>
</ul>
<p><strong>3、脱离Eureka使用Ribbon</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ribbon.eruka.enabled=false</span><br><span class="line">service-name.ribbon.listOfServer= xxx,xxx</span><br></pre></td></tr></table></figure></p>
<p><strong>4、指定名称的Ribbon请求特定URL，其他Ribbon使用Eureka</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service-name.ribbon.NIWSServerListClassName = com.netflix.loadbalancer.ConfigurationBasedServerList</span><br><span class="line">service-name.ribbon.listOfServers = xxx,xxx</span><br></pre></td></tr></table></figure></p>
<h4 id="✎✎✎✎Ribbon的加载"><a href="#✎✎✎✎Ribbon的加载" class="headerlink" title="✎✎✎✎Ribbon的加载"></a><center><font color="#36648B">✎✎✎✎</font><br><font color="#36648B">Ribbon的加载</font></center></h4><p>Ribbon上下文的加载默认是<font color="#CD5555">懒加载</font>的（第一次请求才会加载），可通过如下方式配置成<font color="#CD5555">饥饿加载</font>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ribbon:</span><br><span class="line">   eager-load:</span><br><span class="line">      enabled: true</span><br><span class="line">      clients: client1,client2</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/04/Spring Cloud与Docker微服务架构实战_04_微服务注册与发现/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="aFightz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aFightz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/04/Spring Cloud与Docker微服务架构实战_04_微服务注册与发现/" class="post-title-link" itemprop="http://yoursite.com/page/7/index.html">04 | 微服务注册与发现</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-04 11:18:43" itemprop="dateCreated datePublished" datetime="2019-06-04T11:18:43+08:00">2019-06-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-01-07 16:21:41" itemprop="dateModified" datetime="2020-01-07T16:21:41+08:00">2020-01-07</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Java/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/Java/Spring/Spring-Cloud与Docker微服务架构实战/" itemprop="url" rel="index"><span itemprop="name">Spring Cloud与Docker微服务架构实战</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="✎Eureka-Server"><a href="#✎Eureka-Server" class="headerlink" title="✎Eureka Server"></a><center><font color="#36648B">✎</font><br><font color="#36648B">Eureka Server</font></center></h4><p>微服务启动后，会周期性(<font color="#CD5555">默认为30s</font>)的向Eureka Server发送心跳，以续约自己的租期。<br>Eureka Server在一定时间（<font color="#CD5555">默认为90s</font>）没有接收到微服务实例的心跳，将注销该实例。<br>默认情况下Eureka Server也是Eureka Client。<br>Eureka Client会缓存服务注册表中的信息。<br>如果是一个单点的Eureka Server，可以把<code>eureka.client.registerWithEureka</code>设为false，因为不需要同步其他的Eureka Server节点的信息。</p>
<h4 id="✎✎注册"><a href="#✎✎注册" class="headerlink" title="✎✎注册"></a><center><font color="#36648B">✎✎</font><br><font color="#36648B">注册</font></center></h4><p>若不配置<code>eureka.instance.prefer-ip-address</code>这个属性或者将其设为false，则表示注册微服务<font color="#CD5555">所在操作系统的hostname</font>到Eureka Server。<br>在Spring Cloud Edgware以及更高版本中，只需要添加相关依赖，即可自动注册。<br>若不想将服务注册到Eureka Server，只需设置<code>spring.cloud.service-registry.auto-registration.enabled = false</code>或<code>@EnableDiscoverClient(autoRegister=false)</code>。</p>
<h4 id="✎✎✎Eureka-Server高可用"><a href="#✎✎✎Eureka-Server高可用" class="headerlink" title="✎✎✎Eureka Server高可用"></a><center><font color="#36648B">✎✎✎</font><br><font color="#36648B">Eureka Server高可用</font></center></h4><p>使用yml实现的比较新奇的配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name : xxxx</span><br><span class="line">---</span><br><span class="line">spring:</span><br><span class="line">  profiles: peer1</span><br><span class="line">server:</span><br><span class="line">  port: 8761</span><br><span class="line">eruka:</span><br><span class="line">  instance:</span><br><span class="line">    hostname: peer1</span><br><span class="line">  client:</span><br><span class="line">    serviceUrl:</span><br><span class="line">      defaultZone: http://peer2:8762/eureka/</span><br><span class="line">---</span><br><span class="line">spring:</span><br><span class="line">  profiles: peer2</span><br><span class="line">server:</span><br><span class="line">  port: 8762</span><br><span class="line">eruka:</span><br><span class="line">  instance:</span><br><span class="line">    hostname: peer2</span><br><span class="line">  client:</span><br><span class="line">    serviceUrl:</span><br><span class="line">      defaultZone: http://peer1:8761/eureka/</span><br></pre></td></tr></table></figure></p>
<p>上面使用—将yml文件分为三段，第一段未指定profile，表示是公用的，对所有profile都生效。</p>
<h4 id="✎✎✎✎为Eureka-Server开启认证"><a href="#✎✎✎✎为Eureka-Server开启认证" class="headerlink" title="✎✎✎✎为Eureka Server开启认证"></a><center><font color="#36648B">✎✎✎✎</font><br><font color="#36648B">为Eureka Server开启认证</font></center></h4><p>添加spring-boot-security-starter。</p>
<p><strong>1、通过配置方式开启Basic认证</strong><br>yml添加以下内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">security:</span><br><span class="line">   basic:</span><br><span class="line">      enabled: true</span><br><span class="line">user:</span><br><span class="line">   name: user</span><br><span class="line">      password: password@123 </span><br><span class="line">eureka:</span><br><span class="line">   client:</span><br><span class="line">      serviceUrl:</span><br><span class="line">      defaultZone: http://user:password@123localhost:8761/eureka/</span><br></pre></td></tr></table></figure></p>
<p><strong>2、通过生命Bean的方式开启Basic认证</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DiscoveryClientOptionalArgs <span class="title">discoveryClientOptionalArgs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DiscoveryClientOptionalArgs discoveryClientOptionalArgs = <span class="keyword">new</span> DiscoveryClientOptionalArgs();</span><br><span class="line">    List&lt;CilentFilter&gt; additionalFilters = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    additionalFilters.add(<span class="keyword">new</span> HTTPBasicAuthFilter(<span class="string">"user"</span> , <span class="string">"password123"</span>))</span><br><span class="line">    discoveryClientOptionalArgs.setAdditionalFilters(additionalFilters);</span><br><span class="line">    <span class="keyword">return</span> discoveryClientOptionalArgs;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="✎✎✎✎✎Eureka的元数据"><a href="#✎✎✎✎✎Eureka的元数据" class="headerlink" title="✎✎✎✎✎Eureka的元数据"></a><center><font color="#36648B">✎✎✎✎✎</font><br><font color="#36648B">Eureka的元数据</font></center></h4><p>Eureka的元数据有两种，分别是<font color="#CD5555">标准元数据</font>和<font color="#CD5555">自定义元数据</font>。</p>
<ul>
<li>标准元数据：主机名、IP地址、端口号、状态页和健康检查等信息。</li>
<li>自定义元数据：eureka.instance.metadata-map配置（key-value）。</li>
</ul>
<p><code>DiscoveryClient.getInstance(serviceId)</code>可查询指定微服务在Eureka上的实例列表。包括标准元数据和自定义元数据。<br><code>/eureka/apps</code>可查看Eureka的metadata。</p>
<h4 id="✎✎✎✎✎✎手动对服务进行操作"><a href="#✎✎✎✎✎✎手动对服务进行操作" class="headerlink" title="✎✎✎✎✎✎手动对服务进行操作"></a><center><font color="#36648B">✎✎✎✎✎✎</font><br><font color="#36648B">手动对服务进行操作</font></center></h4><p>可通过 <code>/eureka/apps</code>下的端点，进行服务注册，服务查询，服务注销等操作（用xml交互）。</p>
<h4 id="✎✎✎✎✎✎✎Eureka的自我保护"><a href="#✎✎✎✎✎✎✎Eureka的自我保护" class="headerlink" title="✎✎✎✎✎✎✎Eureka的自我保护"></a><center><font color="#36648B">✎✎✎✎✎✎✎</font><br><font color="#36648B">Eureka的自我保护</font></center></h4><p>进入自我保护模式后，Eureka Server的首页会显示告警。<br>之前有说到，在一定时间（<font color="#CD5555">默认90s</font>）内，如果没收到客户端的心跳，那么server会注销这个客户端，但是如果在短时间丢失过多的客户端（出现网络故障的原因），那么server就会进入自我保护模式，不会删除注册列表里的客户端。当网络故障恢复后，该server会自动退出自我保护模式。<br>禁用自我保护模式。<code>eureka.server.enable-self-perservation = false</code>。</p>
<h4 id="✎✎✎✎✎✎✎✎指定注册到server上的IP"><a href="#✎✎✎✎✎✎✎✎指定注册到server上的IP" class="headerlink" title="✎✎✎✎✎✎✎✎指定注册到server上的IP"></a><center><font color="#36648B">✎✎✎✎✎✎✎✎</font><br><font color="#36648B">指定注册到server上的IP</font></center></h4><p><strong>1、忽略指定名称的网卡</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">   cloud:</span><br><span class="line">      inetutils:</span><br><span class="line">         ignored-interfaces:</span><br><span class="line">            - docker0</span><br><span class="line">            - veth.*</span><br><span class="line">eureka:</span><br><span class="line">   instance:</span><br><span class="line">      prefer-ip-address: true</span><br></pre></td></tr></table></figure></p>
<p><strong>2、使用正则表达式，指定使用的网络地址</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">   cloud:</span><br><span class="line">      inetutils:</span><br><span class="line">         preferredNetworks:</span><br><span class="line">            - 192.168</span><br><span class="line">            - 10.0</span><br><span class="line">eureka:</span><br><span class="line">   instance:</span><br><span class="line">      prefer-ip-address: true</span><br></pre></td></tr></table></figure></p>
<p><strong>3、只使用站点本地地址</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">   cloud:</span><br><span class="line">      inetutils:</span><br><span class="line">         userOnlySiteLocalInterfaces: true</span><br><span class="line">eureka:</span><br><span class="line">   instance:</span><br><span class="line">      prefer-ip-address: true</span><br></pre></td></tr></table></figure></p>
<p><strong>4、手动指定IP地址</strong></p>
<pre><code>eureka:
   instance:
      prefer-ip-address: true
      ip-address: 127.0.0.1
</code></pre><h4 id="✎✎✎✎✎✎✎✎✎健康检查"><a href="#✎✎✎✎✎✎✎✎✎健康检查" class="headerlink" title="✎✎✎✎✎✎✎✎✎健康检查"></a><center><font color="#36648B">✎✎✎✎✎✎✎✎✎</font><br><font color="#36648B">健康检查</font></center></h4><p><strong>1、开启健康检查（不仅仅是心跳保持正常）</strong><br><code>eureka.client.healthcheck.enbaled: true</code><br>加了上述配置时，/pause端点无法正常工作。也无法将状态标记为    down。这个bug未修复。</p>
<p><strong>2、实现自己的健康检查</strong><br>实现HealthCheckHandler接口。</p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">aFightz</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">98</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">35</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">16</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">aFightz</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v6.5.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.5.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.5.0"></script>



  



  










  





  

  

  

  

  
  

  
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  

  


  
  

  

  

  

  

  

  

</body>
</html>
